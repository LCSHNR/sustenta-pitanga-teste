<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sustenta Pitanga</title>
    <!-- Tailwind CSS CDN - Mantido no head para carregamento rápido do estilo base -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome para ícones - Mantido no head para ícones visíveis imediatamente -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Variáveis CSS para cores, facilitando a alternância entre modos claro/escuro */
        :root {
            --bg-color: #f0f4f8;
            --text-color: #333; /* Cor do texto padrão para o modo claro */
            --card-bg: #ffffff;
            --card-shadow: rgba(0, 0, 0, 0.1);
            --header-bg-start: #3b82f6; /* blue-500 */
            --header-bg-end: #10b981; /* green-500 */
            --primary-btn-bg: #3b82f6;
            --primary-btn-hover: #2563eb;
            --secondary-btn-bg: #10b981;
            --secondary-btn-hover: #059669;
            --danger-btn-bg: #ef4444;
            --danger-btn-hover: #dc2626;
            --progress-bar-container: #e2e8f0;
            --chart-btn-bg: #a7f3d0;
            --chart-btn-text: #065f46;
            --chart-btn-border: #34d399;
            --chart-btn-hover: #6ee7b7;
            --chart-btn-active-bg: #10b981;
            --chart-btn-active-text: white;
            --chart-btn-active-border: #059669;
            --popup-bg: white;
            --popup-text: #333;
            --message-box-info-bg: #bfdbfe;
            --message-box-info-border: #60a5fa;
            --message-box-info-text: #1e40af;
            --message-box-success-bg: #d1fae5;
            --message-box-success-border: #34d399;
            --message-box-success-text: #065f46;
            --message-box-error-bg: #fee2e2;
            --message-box-error-border: #ef4444;
            --message-box-error-text: #991b1b;
            --input-bg: #ffffff;
            --input-text: #333;
            --input-border: #d1d5db;
            --link-color: #3b82f6;
            --link-hover: #2563eb;
            --mobile-menu-bg: #ffffff;
            --mobile-menu-border: #e2e8f0;
            --mobile-menu-link-text: #2d3748;
            --mobile-menu-link-hover: #edf2f7;
            --footer-bg: #1a202c; /* gray-800 */
            --footer-text: #ffffff;
            /* Cores para adaptação de texto e fundos específicos */
            --text-gray-700-color: #4a5568;
            --text-gray-600-color: #718096;
            --text-gray-800-color: #2d3748;
            --text-gray-900-color: #1a202c;
            --green-700-color: #2f855a;
            --blue-600-color: #3182ce;
            --green-600-color: #38a169;
            --yellow-600-color: #d69e2e;
            --purple-500-color: #805ad5;
            --red-600-color: #e53e3e;
            --orange-600-color: #dd6b20;
            --blue-50-bg: #ebf8ff;
            --green-50-bg: #f0fff4;
            --yellow-50-bg: #fffff0;
            --blue-800-color: #2a4365;
            --indigo-500-color: #667eea;
            --border-gray-200-color: #edf2f7;
        }

        /* Modo Escuro */
        body.dark-mode {
            --bg-color: #1a202c;
            --text-color: #e2e8f0; /* Cor do texto padrão para o modo escuro (claro) */
            --card-bg: #2d3748;
            --card-shadow: rgba(0, 0, 0, 0.3);
            --header-bg-start: #4a5568; /* gray-700 */
            --header-bg-end: #2d3748; /* gray-800 */
            --primary-btn-bg: #63b3ed;
            --primary-btn-hover: #4299e1;
            --secondary-btn-bg: #48bb78;
            --secondary-btn-hover: #38a169;
            --danger-btn-bg: #fc8181;
            --danger-btn-hover: #e53e3e;
            --progress-bar-container: #4a5568;
            --chart-btn-bg: #4a5568;
            --chart-btn-text: #e2e8f0;
            --chart-btn-border: #616e7f;
            --chart-btn-hover: #616e7f;
            --chart-btn-active-bg: #48bb78;
            --chart-btn-active-text: white;
            --chart-btn-active-border: #38a169;
            --popup-bg: #2d3748;
            --popup-text: #e2e8f0;
            --message-box-info-bg: #2b6cb0;
            --message-box-info-border: #4299e1;
            --message-box-info-text: #e0e0e0;
            --message-box-success-bg: #2f855a;
            --message-box-success-border: #48bb78;
            --message-box-success-text: #e0e0e0;
            --message-box-error-bg: #c53030;
            --message-box-error-border: #e53e3e;
            --message-box-error-text: #e0e0e0;
            --input-bg: #4a5568;
            --input-text: #e2e8f0;
            --input-border: #616e7f;
            --link-color: #63b3ed;
            --link-hover: #4299e1;
            --mobile-menu-bg: #2d3748;
            --mobile-menu-border: #4a5568;
            --mobile-menu-link-text: #e2e8f0;
            --mobile-menu-link-hover: #4a5568;
            --footer-bg: #1a202c;
            --footer-text: #ffffff;
            /* Cores para adaptação de texto e fundos específicos no modo escuro */
            --text-gray-700-color: #a0aec0;
            --text-gray-600-color: #a0aec0;
            --text-gray-800-color: #e2e8f0;
            --text-gray-900-color: #e2e8f0;
            --green-700-color: #68d391;
            --blue-600-color: #63b3ed;
            --green-600-color: #68d391;
            --yellow-600-color: #f6e05e;
            --purple-500-color: #b794f4;
            --red-600-color: #fc8181;
            --orange-600-color: #f6ad55;
            --blue-50-bg: #2a4365;
            --green-50-bg: #2d3748;
            --yellow-50-bg: #2d3748;
            --blue-800-color: #90cdf4;
            --indigo-500-color: #9f7aea;
            --border-gray-200-color: #4a5568;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color); /* Usa a variável de cor de texto padrão */
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        .card {
            background-color: var(--card-bg);
            border-radius: 0.75rem; /* Cantos arredondados */
            box-shadow: 0 4px 12px var(--card-shadow); /* Sombra mais suave */
            padding: 1.5rem;
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            color: var(--text-color); /* Garante que o texto dentro do card seja adaptável */
            /* Removido position: relative; daqui para evitar conflitos com message-box */
        }
        .btn-primary {
            background-color: var(--primary-btn-bg);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary:hover {
            background-color: var(--primary-btn-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-secondary {
            background-color: var(--secondary-btn-bg);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-secondary:hover {
            background-color: var(--secondary-btn-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-danger { /* Novo estilo para botão de sair */
            background-color: var(--danger-btn-bg);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-danger:hover {
            background-color: var(--danger-btn-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .progress-bar-container {
            background-color: var(--progress-bar-container);
            border-radius: 0.5rem;
            height: 1.5rem;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            border-radius: 0.5rem;
            text-align: center;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: width 0.5s ease-in-out; /* Animação da barra de progresso */
        }
        .progress-red { background-color: #ef4444; } /* Vermelho para desperdício alto */
        .progress-orange { background-color: #f97316; } /* Laranja para alerta */
        .progress-green { background-color: #22c55e; } /* Verde para bom desempenho */

        /* Estilo para botões de tipo de gráfico */
        .chart-type-btn {
            @apply px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200;
            background-color: var(--chart-btn-bg);
            color: var(--chart-btn-text);
            border: 1px solid var(--chart-btn-border);
        }
        .chart-type-btn:hover {
            background-color: var(--chart-btn-hover);
        }
        .chart-type-btn.active {
            background-color: var(--chart-btn-active-bg);
            color: var(--chart-btn-active-text);
            border-color: var(--chart-btn-active-border);
        }

        /* Estilos para o pop-up de localização */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* Fundo mais escuro */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .popup-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .popup-content {
            background-color: var(--popup-bg);
            color: var(--popup-text);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3); /* Sombra mais proeminente */
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            position: relative; /* Adicionado para posicionamento absoluto da mensagem interna */
        }
        .popup-overlay.visible .popup-content {
            transform: translateY(0);
            opacity: 1;
        }
        .popup-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .popup-buttons button {
            @apply px-4 py-2 rounded-md text-base font-medium;
            transition: background-color 0.3s ease;
        }
        .popup-buttons .btn-allow-always {
            @apply bg-blue-500 text-white hover:bg-blue-600;
        }
        .popup-buttons .btn-allow-once {
            @apply bg-green-500 text-white hover:bg-green-600;
        }
        .popup-buttons .btn-deny {
            @apply bg-gray-300 text-gray-800 hover:bg-gray-400;
        }

        /* Estilo para mensagens de erro/sucesso - Corrigido para não causar desalinhamento */
        .message-box {
            width: 100%; /* Ocupa a largura total do contêiner pai */
            padding: 0.75rem 1.25rem;
            border-radius: 0.375rem;
            text-align: center;
            font-size: 0.9rem;
            opacity: 0;
            visibility: hidden; /* Esconde completamente quando não visível */
            transition: opacity 0.3s ease, visibility 0.3s ease; /* Transição suave */
            z-index: 10; /* Garante que fique acima de outros conteúdos */
            display: flex; /* Para alinhar ícone e texto */
            align-items: center;
            justify-content: center;
            gap: 0.5rem; /* Espaçamento entre ícone e texto */
            margin-top: 1rem; /* Adiciona margem acima para posicionar abaixo do elemento anterior */
        }
        .message-box.visible {
            opacity: 1;
            visibility: visible;
        }
        .message-box.success { background-color: var(--message-box-success-bg); border: 1px solid var(--message-box-success-border); color: var(--message-box-success-text); }
        .message-box.error { background-color: var(--message-box-error-bg); border: 1px solid var(--message-box-error-border); color: var(--message-box-error-text); }
        .message-box.info { background-color: var(--message-box-info-bg); border: 1px solid var(--message-box-info-border); color: var(--message-box-info-text); }
        .message-box .message-icon { font-size: 1.2rem; } /* Tamanho do ícone */

        /* Ajustes para elementos de formulário no modo escuro */
        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background-color: var(--input-bg);
            color: var(--input-text);
            border-color: var(--input-border);
        }
        body.dark-mode input::placeholder,
        body.dark-mode textarea::placeholder {
            color: #a0aec0;
        }
        
        /* Links para seções */
        .nav-link {
            cursor: pointer;
            @apply px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200;
            color: var(--mobile-menu-link-text); /* Links do menu mobile adaptam ao tema */
        }
        .nav-link:hover {
            background-color: var(--mobile-menu-link-hover);
        }
        .nav-link.active {
            background-color: var(--mobile-menu-link-hover);
        }

        /* Toggle de modo escuro no perfil */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }
        input:checked + .slider:before {
            -webkit-transform: translateX(22px);
            -ms-transform: translateX(22px);
            transform: translateX(22px);
        }
        /* Round sliders */
        .slider.round {
            border-radius: 34px;
        }
        .slider.round:before {
            border-radius: 50%;
        }

        /* Estilo para o botão de modo escuro no header */
        #headerDarkModeToggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white; /* Sempre branco no cabeçalho */
            transition: color 0.3s ease;
            margin-left: 1rem; /* Espaçamento do botão de modo escuro no header */
        }
        #headerDarkModeToggle:hover {
            color: rgba(255, 255, 255, 0.8);
        }

        /* Cores de texto adaptáveis ao tema */
        /* Removidas as classes específicas para garantir que 'color: var(--text-color)' seja o dominante */
        /* As classes Tailwind como text-gray-700 ainda podem ser usadas para nuances, mas a variável principal controlará o contraste */

        /* Cores de fundo adaptáveis ao tema */
        .bg-blue-50 { background-color: var(--blue-50-bg); }
        .bg-green-50 { background-color: var(--green-50-bg); }
        .bg-yellow-50 { background-color: var(--yellow-50-bg); }
        .border-gray-200 { border-color: var(--border-gray-200-color); }

        /* Ajustes para o menu mobile no modo escuro */
        #mobileMenu {
            border-color: var(--mobile-menu-border);
            background-color: var(--mobile-menu-bg);
            /* Transições para o menu mobile */
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform: translateX(100%); /* Começa fora da tela */
            opacity: 0;
            pointer-events: none; /* Impede cliques quando invisível */
        }

        #mobileMenu.active {
            transform: translateX(0); /* Desliza para a tela */
            opacity: 1;
            pointer-events: auto; /* Permite cliques */
        }

        /* Esconder a navegação desktop */
        .header-nav-desktop {
            display: none;
        }

        /* Animação para os resultados da calculadora de impacto */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .impact-results-visible {
            animation: fadeInScale 0.5s ease-out forwards;
        }

        /* Estilos para a aba de resultados da calculadora no modo escuro */
        body.dark-mode #impactResults {
            background-color: var(--card-bg); /* Fundo do card escuro */
            color: var(--text-color); /* Torna o texto dos parágrafos claro */
        }

        body.dark-mode #impactResults h4 {
            color: var(--blue-800-color); /* Torna o título h4 claro (azul claro) */
        }

        /* Estilo para o spinner de carregamento */
        .loading-spinner {
            display: inline-block;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            width: 16px;
            height: 16px;
            vertical-align: middle;
            margin-left: 8px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <header class="bg-gradient-to-r from-blue-500 to-green-500 text-white p-4 shadow-lg rounded-b-xl"
            style="background-image: linear-gradient(to right, var(--header-bg-start), var(--header-bg-end));">
        <div class="container flex justify-between items-center">
            <div class="flex items-center">
                <!-- Usando a imagem ccm.png que você enviou -->
                <img src="ccm.png" alt="Logotipo do Sustenta Pitanga, representando o Centro Comunitário de Múltiplas Funções" class="h-12 w-12 mr-3 rounded-full shadow-md">
                <h1 class="text-3xl font-bold">Sustenta Pitanga</h1>
            </div>
            
            <!-- Botão de modo escuro e menu hambúrguer para todas as telas -->
            <div id="logged-in-controls" class="flex items-center space-x-4 hidden">
                <button id="headerDarkModeToggle" aria-label="Alternar modo escuro">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="notificationsBtn" class="p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors" aria-label="Notificações">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                    </svg>
                </button>
                <button id="menuToggle" class="text-2xl text-white" aria-label="Abrir menu de navegação">
                    <i class="fas fa-bars"></i> <!-- Ícone de hambúrguer -->
                </button>
            </div>
            
            <!-- Menu Mobile (agora serve como menu principal para todas as telas) -->
            <div id="mobileMenu" class="fixed inset-y-0 right-0 w-64 bg-white shadow-lg p-4 z-50 flex flex-col">
                <div class="flex justify-end mb-4">
                    <button id="closeMenu" class="text-gray-600 text-2xl hover:text-gray-800" aria-label="Fechar menu de navegação">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <ul class="space-y-4 flex-grow">
                    <li><a class="nav-link block p-2 rounded-md hover:bg-gray-100" data-target="dashboard"><i class="fas fa-home mr-2"></i>Dashboard</a></li>
                    <li><a class="nav-link block p-2 rounded-md hover:bg-gray-100" data-target="reports"><i class="fas fa-file-alt mr-2"></i>Relatórios</a></li>
                    <li><a class="nav-link block p-2 rounded-md hover:bg-gray-100" data-target="profile"><i class="fas fa-user mr-2"></i>Perfil</a></li>
                    <li><a class="nav-link block p-2 rounded-md hover:bg-gray-100" data-target="about-us"><i class="fas fa-info-circle mr-2"></i>Sobre Nós</a></li> <!-- Novo link -->
                </ul>
            </div>

            <!-- Notificações Dropdown (agora dentro do logged-in-controls) -->
            <div id="notificationsDropdown" class="hidden absolute right-4 top-16 mt-2 w-72 bg-white rounded-md shadow-lg z-10 transition-all duration-300 ease-in-out transform scale-95 opacity-0">
                <div class="p-4 border-b border-gray-200">
                    <h4 class="font-bold text-gray-800">Notificações</h4>
                </div>
                <div class="max-h-60 overflow-y-auto">
                    <a href="#" class="block px-4 py-3 hover:bg-gray-100 border-b border-gray-100">
                        <p class="text-sm font-medium text-gray-900">Alerta de Chuva</p>
                        <p class="text-xs text-gray-500">Prevista chuva forte amanhã - evite irrigação</p>
                    </a>
                    <a href="#" class="block px-4 py-3 hover:bg-gray-100 border-b border-gray-100">
                        <p class="text-sm font-medium text-gray-900">Relatório Mensal</p>
                        <p class="text-xs text-gray-500">Seu relatório de junho está disponível</p>
                    </a>
                    <a href="#" class="block px-4 py-3 hover:bg-gray-100">
                        <p class="text-sm font-medium text-gray-900">Atualização do Sistema</p>
                        <p class="text-xs text-gray-500">Nova versão disponível com melhorias</p>
                    </a>
                </div>
                <div class="p-2 bg-gray-50 text-center rounded-b-md">
                    <a href="#" class="text-sm text-blue-600 hover:underline">Ver todas</a>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-grow container mt-8">
        <!-- Seção de Landing Page (Antigo "Sobre o Projeto") -->
        <section id="landing-page" class="card max-w-4xl mx-auto mb-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-green-700 mb-4">Bem-vindo ao Sustenta Pitanga</h2>
                <p class="text-lg text-gray-700 mb-6">Uma plataforma inovadora para monitoramento agrícola sustentável, desenvolvida pelo CCM Dom Pedro.</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-blue-50 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
                        <svg class="w-12 h-12 mx-auto mb-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        <h3 class="text-xl font-semibold mb-2 text-gray-800">Monitoramento em Tempo Real</h3>
                        <p class="text-gray-600">Acompanhe indicadores de sustentabilidade da sua propriedade.</p>
                    </div>
                    
                    <div class="bg-green-50 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
                        <svg class="w-12 h-12 mx-auto mb-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                        <h3 class="text-xl font-semibold mb-2 text-gray-800">Alertas Inteligentes</h3>
                        <p class="text-gray-600">Receba recomendações para melhorar sua produção.</p>
                    </div>
                    
                    <div class="bg-yellow-50 p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
                        <svg class="w-12 h-12 mx-auto mb-3 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                        <h3 class="text-xl font-semibold mb-2 text-gray-800">Sensores Caseiros</h3>
                        <p class="text-gray-600">Integração com dispositivos IoT para coleta de dados.</p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-center gap-4 mt-6">
                    <button id="goToLoginBtn" class="btn-primary">Acessar Plataforma</button>
                    <button id="goToAboutUsBtn" class="btn-secondary">Saiba Mais</button> <!-- Novo botão -->
                </div>
            </div>
        </section>

        <!-- Seção de Login -->
        <section id="login" class="hidden">
            <div class="card max-w-md mx-auto">
                <h2 class="text-2xl font-semibold mb-6 text-center">Acesse sua Conta</h2>
                <form id="loginForm">
                    <div class="mb-4">
                        <label for="email" class="block text-sm font-bold mb-2">E-mail:</label>
                        <input type="email" id="email" name="email" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="seuemail@exemplo.com" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-sm font-bold mb-2">Senha:</label>
                        <input type="password" id="password" name="password" class="shadow appearance-none border rounded-lg w-full py-2 px-3 mb-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="********" required minlength="6">
                    </div>
                    <div class="flex items-center justify-between">
                        <button type="submit" class="btn-primary w-full" id="loginBtn">
                            <span id="loginBtnText">Entrar</span>
                            <span id="loginBtnSpinner" class="hidden"><i class="fas fa-spinner fa-spin ml-2"></i></span>
                        </button>
                    </div>
                    <p class="text-center text-sm mt-4">Não tem uma conta? <a href="#" id="registerLink" class="text-blue-500 hover:underline">Cadastre-se aqui</a></p>
                    <div id="loginMessage" class="message-box hidden"></div>
                </form>
            </div>
        </section>

        <!-- Seção de Cadastro -->
        <section id="register" class="hidden">
            <div class="card max-w-md mx-auto">
                <h2 class="text-2xl font-semibold mb-6 text-center">Crie sua Conta</h2>
                <form id="registerForm">
                    <div class="mb-4">
                        <label for="registerName" class="block text-sm font-bold mb-2">Nome Completo:</label>
                        <input type="text" id="registerName" name="registerName" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="Seu nome" required>
                    </div>
                    <div class="mb-4">
                        <label for="registerEmail" class="block text-sm font-bold mb-2">E-mail:</label>
                        <input type="email" id="registerEmail" name="registerEmail" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="seuemail@exemplo.com" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
                    </div>
                    <div class="mb-6">
                        <label for="registerPassword" class="block text-sm font-bold mb-2">Senha:</label>
                        <input type="password" id="registerPassword" name="registerPassword" class="shadow appearance-none border rounded-lg w-full py-2 px-3 mb-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="********" required minlength="6">
                    </div>
                    <div class="mb-6">
                        <label for="confirmPassword" class="block text-sm font-bold mb-2">Confirmar Senha:</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" class="shadow appearance-none border rounded-lg w-full py-2 px-3 mb-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="********" required minlength="6">
                    </div>
                    <div class="mb-4">
                        <label for="registerCooperative" class="block text-sm font-bold mb-2">Cooperativa:</label>
                        <input type="text" id="registerCooperative" name="registerCooperative" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="Nome da sua cooperativa (opcional)">
                    </div>
                    <div class="mb-6">
                        <label for="registerFarmData" class="block text-sm font-bold mb-2">Dados da Fazenda:</label>
                        <textarea id="registerFarmData" name="registerFarmData" rows="3" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="Nome da fazenda, área, culturas principais (opcional)"></textarea>
                    </div>
                    <div class="flex items-center justify-between">
                        <button type="submit" class="btn-primary w-full" id="registerSubmitBtn">
                            <span id="registerSubmitBtnText">Cadastrar</span>
                            <span id="registerSubmitBtnSpinner" class="hidden"><i class="fas fa-spinner fa-spin ml-2"></i></span>
                        </button>
                    </div>
                    <p class="text-center text-sm mt-4">Já tem uma conta? <a href="#" id="backToLoginLink" class="text-blue-500 hover:underline">Faça login aqui</a></p>
                    <div id="registerMessage" class="message-box hidden"></div>
                </form>
            </div>
        </section>

        <!-- Dashboard -->
        <section id="dashboard" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Mensagem de Boas-Vindas -->
            <div class="lg:col-span-3 card text-center">
                <h2 id="welcomeMessageDisplay" class="text-2xl font-bold text-green-700 mb-4"></h2>
            </div>
            
            <!-- Card de Desperdício por Hectare -->
            <div class="card">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-trash-alt mr-2 text-red-500"></i>
                    Desperdício por Hectare
                </h3>
                <p class="text-4xl font-bold text-red-600 mb-4">15%</p>
                <div class="progress-bar-container">
                    <div class="progress-bar progress-red" style="width: 75%;">75% da meta</div>
                </div>
                <p class="text-sm mt-2">Meta: 5% de desperdício. <span class="font-semibold">Ação necessária!</span></p>
            </div>

            <!-- Card de Adubos Utilizados -->
            <div class="card">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-leaf mr-2 text-green-500"></i>
                    Adubos Utilizados
                </h3>
                <p class="text-4xl font-bold text-green-600 mb-4">800 kg/ha</p>
                <div class="progress-bar-container">
                    <div class="progress-bar progress-green" style="width: 80%;">80% do recomendado</div>
                </div>
                <p class="text-sm mt-2">Recomendado: 1000 kg/ha. <span class="font-semibold">Bom uso!</span></p>
            </div>

            <!-- Card de Clima Atual -->
            <div class="card">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-cloud-sun mr-2 text-blue-500"></i>
                    Clima Atual
                </h3>
                <div id="weatherInfo">
                    <p class="text-lg">Carregando clima...</p>
                </div>
            </div>

            <!-- Card de Calculadora de Impacto -->
            <div class="card">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-calculator mr-2 text-purple-500"></i>
                    Calculadora de Impacto
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold mb-2">Área Cultivada (hectares)</label>
                        <input type="number" id="cultivatedArea" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" value="10" min="0">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2">Tipo de Cultura</label>
                        <select id="cropType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="feijao">Feijão</option>
                            <option value="arroz">Arroz</option>
                            <option value="cana">Cana-de-Açúcar</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                    <button id="calculateImpactBtn" class="btn-primary w-full">
                        <span id="calculateImpactBtnText">Calcular Resultados</span>
                        <span id="calculateImpactBtnSpinner" class="hidden"><i class="fas fa-spinner fa-spin ml-2"></i></span>
                    </button>
                    <div id="impactCalcMessage" class="message-box hidden"></div>
                    <div id="impactResults" class="p-4 bg-blue-50 rounded-lg">
                        <h4 class="font-bold text-blue-800 mb-2">Resultados:</h4>
                        <p class="text-sm">Hectares afetados: <span id="affectedHectares" class="font-bold">0</span> ha</p>
                        <p class="text-sm">Economia de água: <span id="waterSaved" class="font-bold">0</span> litros/ano</p>
                        <p class="text-sm">Redução de desperdício: <span id="wasteReduction" class="font-bold">0</span>%</p>
                        <p class="text-sm">Economia financeira: R$ <span id="moneySaved" class="font-bold">0</span>/ano</p>
                    </div>
                </div>
            </div>

            <!-- Card de Alertas Úteis -->
            <div class="card lg:col-span-2">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-exclamation-triangle mr-2 text-yellow-500"></i>
                    Alertas Úteis
                </h3>
                <ul class="list-disc pl-5 space-y-2">
                    <li><span class="font-semibold text-red-600">Alerta:</span> Amanhã: CHUVA FORTE - Não irrigue!</li>
                    <li><span class="font-semibold text-orange-600">Recomendação:</span> Reduza a irrigação de água em 4 litros por hectare.</li>
                    <li><span class="font-semibold text-green-600">Notificação:</span> Sensoriamento detectou melhora na qualidade do solo. +10 pontos!</li>
                </ul>
            </div>

            <!-- Card de Dicas de Sustentabilidade -->
            <div class="card">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-lightbulb mr-2 text-purple-500"></i>
                    Dicas de Sustentabilidade
                </h3>
                <ul class="list-disc pl-5 space-y-2">
                    <li>Considere a rotação de culturas para melhorar a saúde do solo.</li>
                    <li>Utilize sistemas de irrigação por gotejamento para otimizar o uso da água.</li>
                    <li>Monitore a saúde das plantas regularmente para identificar problemas precocemente.</li>
                </ul>
            </div>

            <!-- Card de Coleta de Dados Interativa -->
            <div class="card lg:col-span-3">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-database mr-2 text-indigo-500"></i>
                    Coleta de Dados
                </h3>
                <div class="space-y-6">
                    <div>
                        <h4 class="text-lg font-semibold mb-3 flex items-center">
                            <i class="fas fa-keyboard mr-2 text-blue-500"></i>
                            Dados Manuais
                        </h4>
                        <div class="mb-4">
                            <label for="dailyWaterInput" class="block text-sm font-bold mb-2">Gasto de Água Diário (litros):</label>
                            <input type="number" id="dailyWaterInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="Ex: 5000">
                        </div>
                        <div class="mb-4">
                            <label for="fertilizerUseInput" class="block text-sm font-bold mb-2">Uso de Fertilizantes (kg):</label>
                            <input type="number" id="fertilizerUseInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="Ex: 200">
                        </div>
                        <div class="mb-4">
                            <label for="soilObservationInput" class="block text-sm font-bold mb-2">Observações do Solo:</label>
                            <textarea id="soilObservationInput" rows="3" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="Ex: Solo úmido, boa drenagem."></textarea>
                        </div>
                        <button id="saveManualDataBtn" class="btn-primary">
                            <span id="saveManualDataBtnText">Salvar Dados Manuais</span>
                            <span id="saveManualDataBtnSpinner" class="hidden"><i class="fas fa-spinner fa-spin ml-2"></i></span>
                        </button>
                        <div id="manualSaveMessage" class="message-box hidden"></div>
                    </div>

                    <div class="mt-8">
                        <h4 class="text-lg font-semibold mb-3 flex items-center">
                            <i class="fas fa-microchip mr-2 text-green-500"></i>
                            Sensores Caseiros (Simulado)
                        </h4>
                        <p class="mb-4">Simule a leitura de um medidor de água adaptado com Arduino. Em uma aplicação real, esses dados seriam enviados automaticamente.</p>
                        <div class="mb-4">
                            <label for="waterMeterInput" class="block text-sm font-bold mb-2">Leitura do Medidor de Água (litros/min):</label>
                            <input type="number" id="waterMeterInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" placeholder="Ex: 2.5">
                        </div>
                        <button id="simulateSensorDataBtn" class="btn-secondary">
                            <span id="simulateSensorDataBtnText">Simular Leitura do Sensor</span>
                            <span id="simulateSensorDataBtnSpinner" class="hidden"><i class="fas fa-spinner fa-spin ml-2"></i></span>
                        </button>
                        <div id="sensorSaveMessage" class="message-box hidden"></div>
                    </div>
                </div>
            </div>

            <!-- Card de Mapa da Propriedade (Movido para o final do Dashboard) -->
            <div class="card lg:col-span-3">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-map-marked-alt mr-2 text-blue-500"></i>
                    Mapa da Propriedade
                </h3>
                <div id="farmMap" class="h-64 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden">
                    <p class="text-gray-500">Carregando mapa...</p>
                </div>
                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button class="btn-secondary">Visualização Satélite</button>
                    <button class="btn-secondary">Visualização Terreno</button>
                    <button class="btn-secondary">Medir Área</button>
                    <button class="btn-secondary">Adicionar Marcador</button>
                </div>
            </div>
        </section>

        <!-- Seção de Relatórios (Atualizada) -->
        <section id="reports" class="hidden">
            <div class="card">
                <h2 class="text-2xl font-semibold mb-6 text-center">Relatórios Inteligentes</h2>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-semibold mb-3 flex items-center">
                            <i class="fas fa-chart-bar mr-2 text-blue-500"></i>
                            Relatório Mensal - Junho 2025
                        </h3>
                        <p class="text-lg mb-2">Impacto Econômico: <span class="font-bold text-green-600">Economia de R$ 2.500</span> em fertilizantes.</p>
                        <ul class="list-disc pl-5 space-y-2">
                            <li>Desperdício médio: 8% (redução de 7% em relação ao mês anterior).</li>
                            <li>Uso de água: 1200 litros/hectare (dentro da meta).</li>
                            <li>Qualidade do solo: Melhoria de 15% nos indicadores.</li>
                        </ul>
                    </div>

                    <div>
                        <h3 class="text-xl font-semibold mb-3 flex items-center">
                            <i class="fas fa-file-alt mr-2 text-purple-500"></i>
                            Relatório Personalizado - Uso de Pesticidas (Maio 2025)
                        </h3>
                        <p class="text-lg mb-2">Impacto Ambiental: <span class="font-bold text-red-600">Uso acima do recomendado em 10%</span>.</p>
                        <ul class="list-disc pl-5 space-y-2">
                            <li>Pesticida X: 5% acima do limite seguro.</li>
                            <li>Recomendação: Avaliar alternativas biológicas para a próxima safra.</li>
                        </ul>
                    </div>

                    <div class="mt-8 text-center">
                        <h3 class="text-xl font-semibold mb-4">Tipo de Gráfico</h3>
                        <div class="flex flex-wrap justify-center gap-2 mb-6" id="chartTypeButtons">
                            <button class="chart-type-btn active" data-chart-type="pie">Pizza</button>
                            <button class="chart-type-btn" data-chart-type="bar-column">Coluna</button>
                            <button class="chart-type-btn" data-chart-type="line">Linhas</button>
                            <button class="chart-type-btn" data-chart-type="doughnut">Rosca</button>
                            <button class="chart-type-btn" data-chart-type="bar-horizontal">Barras</button>
                            <button class="chart-type-btn" data-chart-type="radar">Radar</button>
                        </div>
                    </div>

                    <div class="mt-8">
                        <h3 class="text-xl font-semibold mb-4 text-center">Desperdício vs. Uso Eficiente (por Hectare)</h3>
                        <div class="w-full max-w-sm mx-auto">
                            <canvas id="myChart"></canvas>
                        </div>
                    </div>

                    <div class="text-center mt-8">
                        <button id="generatePdfReportBtn" class="btn-secondary">
                            <span id="generatePdfReportBtnText">Gerar Relatório em PDF</span>
                            <span id="generatePdfReportBtnSpinner" class="hidden"><i class="fas fa-spinner fa-spin ml-2"></i></span>
                        </button>
                        <div id="pdfMessage" class="message-box hidden"></div>
                    </div>
                </div>
                <div class="text-center mt-8">
                    <button id="backToDashboardFromReportsBtn" class="btn-secondary">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar para o Dashboard
                    </button>
                </div>
            </div>
        </section>

        <!-- Seção de Perfil -->
        <section id="profile" class="hidden">
            <div class="card max-w-2xl mx-auto">
                <h2 class="text-2xl font-semibold mb-6 text-center">Meu Perfil</h2>
                <div class="flex flex-col md:flex-row items-center md:items-start gap-8">
                    <div class="flex-shrink-0">
                        <img id="profilePicImg" src="https://placehold.co/150x150/a7f3d0/065f46?text=Foto" alt="Foto de perfil do usuário, atualmente uma imagem de placeholder" class="w-36 h-36 rounded-full object-cover border-4 border-green-400 shadow-md">
                        <input type="file" id="profilePicInput" accept="image/png, image/jpeg, image="jpg" class="hidden">
                        <button id="changeProfilePicBtn" class="mt-4 w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors">Alterar Foto</button>
                        <div id="profilePicMessage" class="message-box hidden mt-2"></div>
                    </div>

                    <div class="flex-grow w-full">
                        <div class="mb-4">
                            <label for="profileNameInput" class="block text-sm font-bold mb-2">Nome:</label>
                            <input type="text" id="profileNameInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400">
                        </div>
                        <div class="mb-4">
                            <label for="profileEmailInput" class="block text-sm font-bold mb-2">E-mail:</label>
                            <input type="email" id="profileEmailInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400" disabled>
                        </div>
                        <div class="mb-4">
                            <label for="profileCooperativeInput" class="block text-sm font-bold mb-2">Cooperativa:</label>
                            <input type="text" id="profileCooperativeInput" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400">
                        </div>
                        <div class="mb-4">
                            <label for="profileFarmDataInput" class="block text-sm font-bold mb-2">Dados da Fazenda:</label>
                            <textarea id="profileFarmDataInput" rows="4" class="shadow appearance-none border rounded-lg w-full py-2 px-3 leading-tight focus:outline-none focus:shadow-outline focus:border-blue-400"></textarea>
                        </div>
                        <div class="text-right mt-6 flex justify-end gap-4">
                            <button id="saveProfileBtn" class="btn-primary">
                                <span id="saveProfileBtnText">Salvar Alterações</span>
                                <span id="saveProfileBtnSpinner" class="hidden"><i class="fas fa-spinner fa-spin ml-2"></i></span>
                            </button>
                            <button id="logoutBtn" class="btn-danger">Sair da Conta</button>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-8">
                    <button id="backToDashboardFromProfileBtn" class="btn-secondary">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar para o Dashboard
                    </button>
                </div>
            </div>
        </section>

        <!-- Nova Seção "Sobre Nós" -->
        <section id="about-us" class="hidden">
            <div class="card max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-green-700 mb-6 text-center">Nossa História e Missão</h2>
                <div class="space-y-6 text-lg text-gray-700">
                    <p>No coração de Pitanga, o Sustenta Pitanga é uma iniciativa do <strong>Centro Comunitário de Múltiplas Funções (CCM Dom Pedro)</strong>, nascido da visão de transformar a agricultura local através da sustentabilidade e tecnologia.</p>
                    
                    <h3 class="text-2xl font-semibold text-blue-600 flex items-center"><i class="fas fa-eye mr-3"></i>Nossa Visão</h3>
                    <p>Visualizamos um futuro onde cada produtor em Pitanga, independentemente do tamanho de sua propriedade, tenha acesso a ferramentas e conhecimentos para cultivar de forma mais eficiente, respeitando o meio ambiente e garantindo a prosperidade de suas famílias.</p>

                    <h3 class="text-2xl font-semibold text-green-600 flex items-center"><i class="fas fa-building mr-3"></i>O CCM Dom Pedro</h3>
                    <p>O CCM Dom Pedro, com sua longa história de serviço à comunidade, identificou a necessidade de uma abordagem mais moderna e sustentável na agricultura. O Sustenta Pitanga é a nossa resposta a essa demanda, unindo tradição e inovação para o benefício de todos.</p>

                    <h3 class="text-2xl font-semibold text-yellow-600 flex items-center"><i class="fas fa-handshake mr-3"></i>Nossos Pilares</h3>
                    <ul class="list-disc pl-8 space-y-3">
                        <li><strong>Educação e Capacitação:</strong> Oferecemos workshops, treinamentos e materiais educativos para empoderar os agricultores com as melhores práticas.</li>
                        <li><strong>Tecnologia Acessível:</strong> Desenvolvemos e implementamos soluções de Internet das Coisas (IoT) de baixo custo para monitoramento inteligente de lavouras.</li>
                        <li><strong>Sustentabilidade Ambiental:</strong> Promovemos ativamente práticas agrícolas que conservam recursos naturais, reduzem o impacto ecológico e protegem a biodiversidade.</li>
                        <li><strong>Prosperidade Local:</strong> Contribuímos para o aumento da produtividade, otimização de recursos e, consequentemente, a melhoria da renda e qualidade de vida dos agricultores de Pitanga.</li>
                    </ul>

                    <p class="text-center font-bold text-purple-500 mt-8">Junte-se a nós nesta jornada rumo a uma Pitanga mais verde e próspera!</p>

                    <div class="mt-12 text-center">
                        <h3 class="text-2xl font-bold text-blue-700 mb-6">Nossa Equipe</h3>
                        <div class="mb-8">
                            <img src="https://placehold.co/400x200/a7f3d0/065f46?text=Foto+da+Equipe" alt="Foto da equipe do Sustenta Pitanga" class="w-full max-w-md mx-auto rounded-lg shadow-lg object-cover">
                            <p class="text-sm text-gray-500 mt-2">Uma visão geral do nosso time dedicado.</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            <!-- Membro 1 -->
                            <div class="card p-6 flex flex-col items-center text-center">
                                <img src="https://placehold.co/100x100/3b82f6/ffffff?text=Membro1" alt="Foto de perfil do Membro 1" class="w-24 h-24 rounded-full object-cover border-4 border-blue-400 mb-4 shadow-md">
                                <h4 class="text-xl font-semibold text-gray-800 mb-2">João Silva</h4>
                                <p class="text-gray-600 text-sm">Engenheiro Agrônomo e Coordenador de Projetos. Especialista em agricultura sustentável e sistemas de irrigação.</p>
                            </div>
                            <!-- Membro 2 -->
                            <div class="card p-6 flex flex-col items-center text-center">
                                <img src="https://placehold.co/100x100/10b981/ffffff?text=Membro2" alt="Foto de perfil do Membro 2" class="w-24 h-24 rounded-full object-cover border-4 border-green-400 mb-4 shadow-md">
                                <h4 class="text-xl font-semibold text-gray-800 mb-2">Maria Oliveira</h4>
                                <p class="text-gray-600 text-sm">Desenvolvedora de Software e Arquiteta de IoT. Responsável pela integração dos sensores e plataforma.</p>
                            </div>
                            <!-- Membro 3 -->
                            <div class="card p-6 flex flex-col items-center text-center">
                                <img src="https://placehold.co/100x100/ef4444/ffffff?text=Membro3" alt="Foto de perfil do Membro 3" class="w-24 h-24 rounded-full object-cover border-4 border-red-400 mb-4 shadow-md">
                                <h4 class="text-xl font-semibold text-gray-800 mb-2">Carlos Souza</h4>
                                <p class="text-gray-600 text-sm">Especialista em Análise de Dados e Relatórios. Transforma dados brutos em insights acionáveis para os agricultores.</p>
                            </div>
                            <!-- Membro 4 -->
                            <div class="card p-6 flex flex-col items-center text-center">
                                <img src="https://placehold.co/100x100/f97316/ffffff?text=Membro4" alt="Foto de perfil do Membro 4" class="w-24 h-24 rounded-full object-cover border-4 border-orange-400 mb-4 shadow-md">
                                <h4 class="text-xl font-semibold text-gray-800 mb-2">Ana Costa</h4>
                                <p class="text-gray-600 text-sm">Educadora e Facilitadora Comunitária. Ajuda a disseminar o conhecimento e as melhores práticas entre os produtores.</p>
                            </div>
                            <!-- Membro 5 -->
                            <div class="card p-6 flex flex-col items-center text-center">
                                <img src="https://placehold.co/100x100/805ad5/ffffff?text=Membro5" alt="Foto de perfil do Membro 5" class="w-24 h-24 rounded-full object-cover border-4 border-purple-400 mb-4 shadow-md">
                                <h4 class="text-xl font-semibold text-gray-800 mb-2">Pedro Santos</h4>
                                <p class="text-gray-600 text-sm">Técnico em Eletrônica e Manutenção de Sensores. Garante que a infraestrutura tecnológica esteja sempre funcionando.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-8">
                    <button id="backToLandingFromAboutUsBtn" class="btn-secondary">
                        <i class="fas fa-arrow-left mr-2"></i>Voltar
                    </button>
                </div>
            </div>
        </section>

    </main>

    <!-- Popup de Permissão de Localização -->
    <div id="locationPermissionPopup" class="popup-overlay hidden">
        <div class="popup-content">
            <h3 class="text-xl font-semibold mb-4">Permissão de Localização</h3>
            <p>Para fornecer dados climáticos precisos e funcionalidades de mapa, o Sustenta Pitanga precisa acessar sua localização.</p>
            <div class="mt-4 flex items-center justify-center">
                <input type="checkbox" id="doNotAskAgain" class="mr-2">
                <label for="doNotAskAgain" class="text-sm">Não perguntar novamente</label>
            </div>
            <div class="popup-buttons">
                <button id="allowLocationBtn" class="btn-primary">Permitir Localização</button>
                <button id="denyLocationBtn" class="btn-danger">Negar</button>
            </div>
            <div id="locationMessage" class="message-box hidden"></div>
        </div>
    </div> 

    <footer class="bg-gray-800 text-white p-4 text-center mt-8 rounded-t-xl"
            style="background-color: var(--footer-bg); color: var(--footer-text);">
        <div class="container">
            <p>&copy; 2024 Sustenta Pitanga. Todos os direitos reservados.</p>
        </div>
    </footer>
    
    <!-- Scripts JavaScript - Movidos para o final do body para melhor performance -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Variáveis globais para simular dados do usuário e estado de login
        let currentUser = null;
        const users = JSON.parse(localStorage.getItem('users')) || {};
        let loggedInUserEmail = localStorage.getItem('loggedInUserEmail'); // Usar let para poder reatribuir
        
        // Instâncias de gráficos
        let myChartInstance = null; // Agora uma única instância para o gráfico principal

        // API Key do OpenWeatherMap (Substitua pela sua chave real)
        // ATENÇÃO: Em uma aplicação real, chaves de API nunca devem ser expostas no frontend.
        // Elas devem ser gerenciadas por um servidor backend.
        const WEATHER_API_KEY = "YOUR_OPENWEATHERMAP_API_KEY"; // Substitua por sua chave real
        const WEATHER_API_URL = "https://api.openweathermap.org/data/2.5/weather";

        // Obter elementos do DOM
        const landingPageSection = document.getElementById('landing-page'); // Renomeado
        const loginSection = document.getElementById('login');
        const registerSection = document.getElementById('register');
        const dashboardSection = document.getElementById('dashboard');
        const reportsSection = document.getElementById('reports');
        const profileSection = document.getElementById('profile');
        const aboutUsSection = document.getElementById('about-us'); // Nova seção
        
        const loggedInControls = document.getElementById('logged-in-controls');
        const mobileMenu = document.getElementById('mobileMenu');
        const navLinks = document.querySelectorAll('#mobileMenu .nav-link'); // Seleciona apenas links dentro do menu mobile
        const notificationsBtn = document.getElementById('notificationsBtn');
        const notificationsDropdown = document.getElementById('notificationsDropdown');
        const menuToggle = document.getElementById('menuToggle');
        const closeMenuBtn = document.getElementById('closeMenu'); // Botão para fechar o menu mobile
        
        const goToLoginBtn = document.getElementById('goToLoginBtn');
        const goToAboutUsBtn = document.getElementById('goToAboutUsBtn'); // Novo botão
        const backToLandingFromAboutUsBtn = document.getElementById('backToLandingFromAboutUsBtn'); // Novo botão
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn'); // Botão de login
        const registerForm = document.getElementById('registerForm');
        const registerSubmitBtn = document.getElementById('registerSubmitBtn'); // Botão de cadastro
        const registerLink = document.getElementById('registerLink');
        const backToLoginLink = document.getElementById('backToLoginLink');
        const logoutBtn = document.getElementById('logoutBtn');
        
        const welcomeMessageDisplay = document.getElementById('welcomeMessageDisplay');
        const weatherInfo = document.getElementById('weatherInfo');
        const farmMap = document.getElementById('farmMap');
        
        const cultivatedAreaInput = document.getElementById('cultivatedArea');
        const cropTypeSelect = document.getElementById('cropType');
        const calculateImpactBtn = document.getElementById('calculateImpactBtn');
        const impactResults = document.getElementById('impactResults');
        const affectedHectaresSpan = document.getElementById('affectedHectares');
        const waterSavedSpan = document.getElementById('waterSaved');
        const wasteReductionSpan = document.getElementById('wasteReduction');
        const moneySavedSpan = document.getElementById('moneySaved');
        const impactCalcMessage = document.getElementById('impactCalcMessage');
        
        const dailyWaterInput = document.getElementById('dailyWaterInput');
        const fertilizerUseInput = document.getElementById('fertilizerUseInput');
        const soilObservationInput = document.getElementById('soilObservationInput');
        const saveManualDataBtn = document.getElementById('saveManualDataBtn');
        const manualSaveMessage = document.getElementById('manualSaveMessage');
        
        const waterMeterInput = document.getElementById('waterMeterInput');
        const simulateSensorDataBtn = document.getElementById('simulateSensorDataBtn');
        const sensorSaveMessage = document.getElementById('sensorSaveMessage');
        
        const generatePdfReportBtn = document.getElementById('generatePdfReportBtn');
        const pdfMessage = document.getElementById('pdfMessage'); // Novo elemento de mensagem para PDF
        
        const profileNameInput = document.getElementById('profileNameInput');
        const profileEmailInput = document.getElementById('profileEmailInput');
        const profileCooperativeInput = document.getElementById('profileCooperativeInput');
        const profileFarmDataInput = document.getElementById('profileFarmDataInput');
        const headerDarkModeToggle = document.getElementById('headerDarkModeToggle');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        
        const changeProfilePicBtn = document.getElementById('changeProfilePicBtn');
        const profilePicInput = document.getElementById('profilePicInput');
        const profilePicImg = document.getElementById('profilePicImg');
        const profilePicMessage = document.getElementById('profilePicMessage');

        const locationPermissionPopup = document.getElementById('locationPermissionPopup');
        const allowLocationBtn = document.getElementById('allowLocationBtn');
        const denyLocationBtn = document.getElementById('denyLocationBtn');
        const doNotAskAgainCheckbox = document.getElementById('doNotAskAgain'); // Novo checkbox
        const locationMessage = document.getElementById('locationMessage');

        // Referências para os spans de texto e spinner dos botões
        const loginBtnText = document.getElementById('loginBtnText');
        const loginBtnSpinner = document.getElementById('loginBtnSpinner');
        const registerSubmitBtnText = document.getElementById('registerSubmitBtnText');
        const registerSubmitBtnSpinner = document.getElementById('registerSubmitBtnSpinner');
        const calculateImpactBtnText = document.getElementById('calculateImpactBtnText');
        const calculateImpactBtnSpinner = document.getElementById('calculateImpactBtnSpinner');
        const saveManualDataBtnText = document.getElementById('saveManualDataBtnText');
        const saveManualDataBtnSpinner = document.getElementById('saveManualDataBtnSpinner');
        const simulateSensorDataBtnText = document.getElementById('simulateSensorDataBtnText');
        const simulateSensorDataBtnSpinner = document.getElementById('simulateSensorDataBtnSpinner');
        const generatePdfReportBtnText = document.getElementById('generatePdfReportBtnText');
        const generatePdfReportBtnSpinner = document.getElementById('generatePdfReportBtnSpinner');
        const saveProfileBtnText = document.getElementById('saveProfileBtnText');
        const saveProfileBtnSpinner = document.getElementById('saveProfileBtnSpinner');

        // Novos botões de voltar para o Dashboard
        const backToDashboardFromProfileBtn = document.getElementById('backToDashboardFromProfileBtn');
        const backToDashboardFromReportsBtn = document.getElementById('backToDashboardFromReportsBtn');

        // Variável para armazenar a seção atual
        let currentSectionId = '';

        // Função para exibir mensagens
        function showMessage(element, message, type = 'info') {
            if (!element) return;
            // Adiciona o ícone com base no tipo de mensagem
            let iconHtml = '';
            if (type === 'success') {
                iconHtml = '<i class="message-icon fas fa-check-circle"></i>';
            } else if (type === 'error') {
                iconHtml = '<i class="message-icon fas fa-times-circle"></i>';
            } else { // 'info' ou qualquer outro
                iconHtml = '<i class="message-icon fas fa-info-circle"></i>';
            }
            element.innerHTML = `${iconHtml}<span>${message}</span>`;
            element.className = `message-box ${type} visible`; // Adiciona 'visible' para animação
            element.classList.remove('hidden');
            setTimeout(() => {
                element.classList.remove('visible'); // Inicia a transição para esconder
                setTimeout(() => {
                    element.classList.add('hidden'); // Esconde após a transição
                }, 300); // Tempo da transição
            }, 5000);
        }

        // Funções para mostrar/esconder loading spinner em botões
        function showLoading(buttonElement, textSpan, spinnerSpan) {
            buttonElement.disabled = true;
            if (textSpan) textSpan.classList.add('hidden');
            if (spinnerSpan) spinnerSpan.classList.remove('hidden');
        }

        function hideLoading(buttonElement, textSpan, spinnerSpan) {
            buttonElement.disabled = false;
            if (textSpan) textSpan.classList.remove('hidden');
            if (spinnerSpan) spinnerSpan.classList.add('hidden');
        }

        // Função para alternar seções e gerenciar o histórico do navegador
        function showSection(sectionId, pushState = true) {
            const sections = [landingPageSection, loginSection, registerSection, dashboardSection, reportsSection, profileSection, aboutUsSection];
            sections.forEach(section => {
                if (section && section.id === sectionId) {
                    section.classList.remove('hidden');
                } else if (section) {
                    section.classList.add('hidden');
                }
            });

            // Esconder menu mobile ao navegar
            if (mobileMenu) {
                mobileMenu.classList.remove('active');
            }

            // Atualizar estado ativo dos links de navegação
            navLinks.forEach(link => {
                if (link.dataset.target === sectionId) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });

            // Gerenciar o histórico do navegador
            if (pushState && currentSectionId !== sectionId) {
                history.pushState({ section: sectionId }, '', `#${sectionId}`);
            }
            currentSectionId = sectionId; // Atualiza a seção atual
        }

        // Função para verificar o estado de login
        function checkLoginState() {
            if (loggedInUserEmail && users[loggedInUserEmail]) {
                currentUser = users[loggedInUserEmail];
                if (welcomeMessageDisplay) welcomeMessageDisplay.textContent = `Bem-vindo(a), ${currentUser.name || currentUser.email}!`;
                showSection('dashboard', false); // Não adiciona ao histórico na inicialização
                loggedInControls.classList.remove('hidden'); // Mostrar controles após login
                checkLocationPermission();
                loadManualData(); // Carrega os dados manuais ao logar
            } else {
                showSection('landing-page', false); // Não adiciona ao histórico na inicialização
                loggedInControls.classList.add('hidden'); // Esconder controles antes do login
            }
        }

        // Lidar com o evento popstate (navegação do navegador - botões voltar/avançar)
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.section) {
                showSection(event.state.section, false); // Não adiciona novamente ao histórico
                if (event.state.section === 'profile') {
                    loadProfileData();
                }
                if (event.state.section === 'reports') {
                    initChart('pie');
                }
            } else {
                // Se não houver estado, volta para a landing page ou dashboard, dependendo do login
                checkLoginState();
            }
        });

        // Função para lidar com o login
        if (loginForm && loginBtn) {
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showLoading(loginBtn, loginBtnText, loginBtnSpinner);
                const email = e.target.email.value;
                const password = e.target.password.value;

                // Validação básica do lado do cliente
                if (!email || !password) {
                    showMessage(document.getElementById('loginMessage'), 'Por favor, preencha todos os campos.', 'error');
                    hideLoading(loginBtn, loginBtnText, loginBtnSpinner);
                    return;
                }
                if (!email.includes('@') || !email.includes('.')) {
                    showMessage(document.getElementById('loginMessage'), 'Por favor, insira um e-mail válido.', 'error');
                    hideLoading(loginBtn, loginBtnText, loginBtnSpinner);
                    return;
                }
                if (password.length < 6) {
                    showMessage(document.getElementById('loginMessage'), 'A senha deve ter no mínimo 6 caracteres.', 'error');
                    hideLoading(loginBtn, loginBtnText, loginBtnSpinner);
                    return;
                }

                // Simulação de delay para a "requisição"
                await new Promise(resolve => setTimeout(resolve, 1000));

                if (users[email] && users[email].password === password) {
                    currentUser = users[email];
                    localStorage.setItem('loggedInUserEmail', email);
                    showMessage(document.getElementById('loginMessage'), 'Login bem-sucedido!', 'success');
                    if (welcomeMessageDisplay) welcomeMessageDisplay.textContent = `Bem-vindo(a), ${currentUser.name || currentUser.email}!`;
                    loggedInControls.classList.remove('hidden'); // Mostrar controles após login
                    showSection('dashboard'); // Adiciona ao histórico
                    checkLocationPermission(); // Check location after successful login
                    loadManualData(); // Carrega os dados manuais ao logar
                } else {
                    showMessage(document.getElementById('loginMessage'), 'E-mail ou senha inválidos.', 'error');
                }
                hideLoading(loginBtn, loginBtnText, loginBtnSpinner);
            });
        }

        // Função para lidar com o cadastro
        if (registerForm && registerSubmitBtn) {
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                showLoading(registerSubmitBtn, registerSubmitBtnText, registerSubmitBtnSpinner);
                const name = e.target.registerName.value;
                const email = e.target.registerEmail.value;
                const password = e.target.registerPassword.value;
                const confirmPassword = e.target.confirmPassword.value;
                const cooperative = e.target.registerCooperative.value;
                const farmData = e.target.registerFarmData.value;

                // Validação básica do lado do cliente
                if (!name || !email || !password || !confirmPassword) {
                    showMessage(document.getElementById('registerMessage'), 'Por favor, preencha todos os campos obrigatórios.', 'error');
                    hideLoading(registerSubmitBtn, registerSubmitBtnText, registerSubmitBtnSpinner);
                    return;
                }
                if (password !== confirmPassword) {
                    showMessage(document.getElementById('registerMessage'), 'As senhas não coincidem.', 'error');
                    hideLoading(registerSubmitBtn, registerSubmitBtnText, registerSubmitBtnSpinner);
                    return;
                }
                if (password.length < 6) {
                    showMessage(document.getElementById('registerMessage'), 'A senha deve ter no mínimo 6 caracteres.', 'error');
                    hideLoading(registerSubmitBtn, registerSubmitBtnText, registerSubmitBtnSpinner);
                    return;
                }
                if (users[email]) {
                    showMessage(document.getElementById('registerMessage'), 'Este e-mail já está cadastrado.', 'error');
                    hideLoading(registerSubmitBtn, registerSubmitBtnText, registerSubmitBtnSpinner);
                    return;
                }
                if (!email.includes('@') || !email.includes('.')) {
                    showMessage(document.getElementById('registerMessage'), 'Por favor, insira um e-mail válido.', 'error');
                    hideLoading(registerSubmitBtn, registerSubmitBtnText, registerSubmitBtnSpinner);
                    return;
                }

                // Simulação de delay para a "requisição"
                await new Promise(resolve => setTimeout(resolve, 1000));

                users[email] = { name, email, password, cooperative, farmData, profilePic: "https://placehold.co/150x150/a7f3d0/065f46?text=Foto", manualData: {} }; // Adiciona foto padrão e objeto para dados manuais
                localStorage.setItem('users', JSON.stringify(users));
                showMessage(document.getElementById('registerMessage'), 'Cadastro realizado com sucesso! Faça login.', 'success');
                e.target.reset(); // Limpa o formulário
                showSection('login'); // Adiciona ao histórico
                hideLoading(registerSubmitBtn, registerSubmitBtnText, registerSubmitBtnSpinner);
            });
        }

        // Eventos de navegação
        if (goToLoginBtn) goToLoginBtn.addEventListener('click', () => showSection('login'));
        if (goToAboutUsBtn) goToAboutUsBtn.addEventListener('click', () => showSection('about-us'));
        
        // Lógica do botão "Voltar" na seção "Sobre Nós"
        if (backToLandingFromAboutUsBtn) {
            backToLandingFromAboutUsBtn.addEventListener('click', () => {
                if (currentUser) {
                    showSection('dashboard');
                } else {
                    showSection('landing-page');
                }
            });
        }

        // Novos botões de "Voltar para o Dashboard"
        if (backToDashboardFromProfileBtn) {
            backToDashboardFromProfileBtn.addEventListener('click', () => showSection('dashboard'));
        }
        if (backToDashboardFromReportsBtn) {
            backToDashboardFromReportsBtn.addEventListener('click', () => showSection('dashboard'));
        }

        if (registerLink) registerLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('register');
        });
        if (backToLoginLink) backToLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('login');
        });
        if (logoutBtn) logoutBtn.addEventListener('click', () => {
            currentUser = null;
            localStorage.removeItem('loggedInUserEmail');
            loggedInControls.classList.add('hidden'); // Esconder controles ao deslogar
            showSection('landing-page'); // Volta para a tela "Sobre o Projeto" (landing-page) ao deslogar
        });

        // Navegação do menu mobile (agora principal)
        if (menuToggle && mobileMenu) {
            menuToggle.addEventListener('click', () => {
                mobileMenu.classList.add('active'); // Mostra o menu
            });
        }
        if (closeMenuBtn && mobileMenu) {
            closeMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.remove('active'); // Esconde o menu
            });
        }

        if (navLinks) {
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = e.target.dataset.target;
                    if (currentUser || target === 'landing-page' || target === 'about-us') { // Permite acesso a landing-page e about-us sem login
                        showSection(target); // Adiciona ao histórico
                        if (target === 'profile') {
                            loadProfileData();
                        }
                        if (target === 'reports') {
                            initChart('pie'); // Inicializa o gráfico de pizza por padrão ao entrar em relatórios
                        }
                    } else {
                        showMessage(document.getElementById('loginMessage'), 'Por favor, faça login para acessar esta seção.', 'info');
                        showSection('login'); // Adiciona ao histórico
                    }
                });
            });
        }

        // Notificações
        if (notificationsBtn && notificationsDropdown) {
            notificationsBtn.addEventListener('click', () => {
                notificationsDropdown.classList.toggle('hidden');
                notificationsDropdown.classList.toggle('scale-95');
                notificationsDropdown.classList.toggle('opacity-0');
                notificationsDropdown.classList.toggle('scale-100');
                notificationsDropdown.classList.toggle('opacity-100');
            });
        }

        // Fechar dropdown de notificação e menu mobile ao clicar fora
        document.addEventListener('click', (e) => {
            if (notificationsBtn && notificationsDropdown && !notificationsBtn.contains(e.target) && !notificationsDropdown.contains(e.target)) {
                notificationsDropdown.classList.add('hidden');
                notificationsDropdown.classList.remove('scale-100', 'opacity-100');
                notificationsDropdown.classList.add('scale-95', 'opacity-0');
            }
            if (menuToggle && mobileMenu && !menuToggle.contains(e.target) && !mobileMenu.contains(e.target) && !e.target.closest('#mobileMenu')) {
                mobileMenu.classList.remove('active');
            }
        });

        // Calculadora de Impacto
        if (calculateImpactBtn && impactResults) {
            calculateImpactBtn.addEventListener('click', async () => {
                showLoading(calculateImpactBtn, calculateImpactBtnText, calculateImpactBtnSpinner);
                const area = parseFloat(cultivatedAreaInput.value);
                const crop = cropTypeSelect.value;

                if (isNaN(area) || area <= 0) {
                    showMessage(impactCalcMessage, 'Por favor, insira uma área cultivada válida (maior que 0).', 'error');
                    affectedHectaresSpan.textContent = '0';
                    waterSavedSpan.textContent = '0';
                    wasteReductionSpan.textContent = '0';
                    moneySavedSpan.textContent = '0';
                    hideLoading(calculateImpactBtn, calculateImpactBtnText, calculateImpactBtnSpinner);
                    return;
                }

                // Simulação de delay para o cálculo
                await new Promise(resolve => setTimeout(resolve, 700));

                let waterSaved = 0;
                let wasteReduction = 0;
                let moneySaved = 0;

                // Simulação de cálculo de impacto baseada na cultura e área
                switch (crop) {
                    case 'feijao':
                        waterSaved = area * 500; // litros/ano por hectare
                        wasteReduction = 0.05; // 5% de redução
                        moneySaved = area * 150; // R$/ano por hectare
                        break;
                    case 'arroz':
                        waterSaved = area * 1200;
                        wasteReduction = 0.08;
                        moneySaved = area * 250;
                        break;
                    case 'cana':
                        waterSaved = area * 800;
                        wasteReduction = 0.03;
                        moneySaved = area * 100;
                        break;
                    case 'outro': // Valor padrão para "Outro"
                        waterSaved = area * 400;
                        wasteReduction = 0.04;
                        moneySaved = area * 120;
                        break;
                    default:
                        waterSaved = area * 300;
                        wasteReduction = 0.02;
                        moneySaved = area * 80;
                        break;
                }

                if (affectedHectaresSpan) affectedHectaresSpan.textContent = area.toFixed(2);
                if (waterSavedSpan) waterSavedSpan.textContent = waterSaved.toFixed(0);
                if (wasteReductionSpan) wasteReductionSpan.textContent = (wasteReduction * 100).toFixed(1);
                if (moneySavedSpan) moneySavedSpan.textContent = moneySaved.toFixed(2);
                
                impactResults.classList.add('impact-results-visible'); 
                showMessage(impactCalcMessage, 'Impacto calculado com sucesso!', 'success');
                hideLoading(calculateImpactBtn, calculateImpactBtnText, calculateImpactBtnSpinner);
            });
        }

        // Coleta de Dados Manuais
        if (saveManualDataBtn && manualSaveMessage) {
            saveManualDataBtn.addEventListener('click', async () => {
                showLoading(saveManualDataBtn, saveManualDataBtnText, saveManualDataBtnSpinner);
                const dailyWater = dailyWaterInput.value;
                const fertilizerUse = fertilizerUseInput.value;
                const soilObservation = soilObservationInput.value;

                if (!dailyWater || !fertilizerUse || !soilObservation) {
                    showMessage(manualSaveMessage, 'Por favor, preencha todos os campos de dados manuais.', 'error');
                    hideLoading(saveManualDataBtn, saveManualDataBtnText, saveManualDataBtnSpinner);
                    return;
                }

                // Simulação de delay para o salvamento
                await new Promise(resolve => setTimeout(resolve, 700));

                // Salvar dados no currentUser e localStorage
                if (currentUser) {
                    currentUser.manualData = {
                        dailyWater: dailyWater,
                        fertilizerUse: fertilizerUse,
                        soilObservation: soilObservation
                    };
                    users[currentUser.email] = currentUser;
                    localStorage.setItem('users', JSON.stringify(users));
                }

                console.log('Dados Manuais Salvos:', { dailyWater, fertilizerUse, soilObservation });
                showMessage(manualSaveMessage, 'Dados salvos com sucesso!', 'success');
                // Não limpar campos para manter os dados salvos visíveis
                hideLoading(saveManualDataBtn, saveManualDataBtnText, saveManualDataBtnSpinner);
            });
        }

        // Função para carregar dados manuais ao entrar no dashboard
        function loadManualData() {
            if (currentUser && currentUser.manualData) {
                dailyWaterInput.value = currentUser.manualData.dailyWater || '';
                fertilizerUseInput.value = currentUser.manualData.fertilizerUse || '';
                soilObservationInput.value = currentUser.manualData.soilObservation || '';
            } else {
                // Limpa os campos se não houver dados salvos
                dailyWaterInput.value = '';
                fertilizerUseInput.value = '';
                soilObservationInput.value = '';
            }
        }

        // Simulação de Dados de Sensor
        if (simulateSensorDataBtn && sensorSaveMessage) {
            simulateSensorDataBtn.addEventListener('click', async () => {
                showLoading(simulateSensorDataBtn, simulateSensorDataBtnText, simulateSensorDataBtnSpinner);
                const waterReading = parseFloat(waterMeterInput.value);

                if (isNaN(waterReading) || waterReading < 0) {
                    showMessage(sensorSaveMessage, 'Por favor, insira uma leitura de medidor de água válida.', 'error');
                    hideLoading(simulateSensorDataBtn, simulateSensorDataBtnText, simulateSensorDataBtnSpinner);
                    return;
                }

                // Simulação de delay para o salvamento
                await new Promise(resolve => setTimeout(resolve, 700));

                console.log('Leitura do Sensor Salva:', { waterReading });
                showMessage(sensorSaveMessage, 'Leitura do sensor simulada e salva!', 'success');
                waterMeterInput.value = '';
                hideLoading(simulateSensorDataBtn, simulateSensorDataBtnText, simulateSensorDataBtnSpinner);
            });
        }

        // Geração de Relatório PDF
        if (generatePdfReportBtn) {
            generatePdfReportBtn.addEventListener('click', async () => {
                showLoading(generatePdfReportBtn, generatePdfReportBtnText, generatePdfReportBtnSpinner);
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                doc.setFontSize(22);
                doc.text("Relatório de Sustentabilidade - Sustenta Pitanga", 10, 20);
                doc.setFontSize(12);
                doc.text(`Gerado em: ${new Date().toLocaleDateString()}`, 10, 30);
                doc.text(`Usuário: ${currentUser ? currentUser.name : 'Convidado'}`, 10, 40);

                let y = 60;

                // Adicionar dados do dashboard
                doc.setFontSize(16);
                doc.text("Resumo do Dashboard", 10, y);
                y += 10;
                doc.setFontSize(12);
                doc.text(`Desperdício por Hectare: ${document.querySelector('#dashboard .card:nth-child(2) .text-4xl').textContent}`, 10, y);
                y += 7;
                doc.text(`Adubos Utilizados: ${document.querySelector('#dashboard .card:nth-child(3) .text-4xl').textContent}`, 10, y);
                y += 7;
                doc.text(`Clima Atual: ${weatherInfo.textContent.trim()}`, 10, y);
                y += 15;

                // Adicionar gráfico principal como imagem
                const canvas = document.getElementById('myChart');
                if (canvas) {
                    const imgData = canvas.toDataURL('image/png');
                    doc.text("Desperdício vs. Uso Eficiente", 10, y);
                    y += 5;
                    doc.addImage(imgData, 'PNG', 10, y, 180, 90); // Ajuste as dimensões conforme necessário
                    y += 100;
                }
                
                // Simulação de delay para a geração do PDF
                await new Promise(resolve => setTimeout(resolve, 1500));

                doc.save('relatorio_sustenta_pitanga.pdf');
                showMessage(pdfMessage, 'Relatório PDF gerado com sucesso!', 'success'); // Atualizado
                hideLoading(generatePdfReportBtn, generatePdfReportBtnText, generatePdfReportBtnSpinner);
            });
        }

        // Função para renderizar gráfico (agora uma única função para o gráfico principal)
        function initChart(chartType = 'pie') {
            const ctx = document.getElementById('myChart');

            if (myChartInstance) {
                myChartInstance.destroy();
            }

            let chartConfig = {};
            const data = {
                labels: ['Desperdício Atual (15%)', 'Uso Eficiente (85%)'],
                datasets: [{
                    data: [15, 85],
                    backgroundColor: [
                        '#ef4444', /* Vermelho para desperdício */
                        '#22c55e'  /* Verde para eficiente */
                    ],
                    borderColor: document.body.classList.contains('dark-mode') ? '#2d3748' : '#ffffff', /* Borda adapta ao tema */
                    borderWidth: 2,
                }]
            };

            const barData = {
                labels: ['Desperdício', 'Uso Eficiente'],
                datasets: [{
                    label: 'Percentual',
                    data: [15, 85],
                    backgroundColor: [
                        '#ef4444',
                        '#22c55e'
                    ],
                    borderColor: document.body.classList.contains('dark-mode') ? '#2d3748' : '#ffffff',
                    borderWidth: 1,
                }]
            };

            const lineData = {
                labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                datasets: [{
                    label: 'Desperdício Mensal (%)',
                    data: [20, 18, 15, 12, 10, 8],
                    borderColor: document.body.classList.contains('dark-mode') ? '#63b3ed' : '#3b82f6', /* Azul adapta ao tema */
                    backgroundColor: document.body.classList.contains('dark-mode') ? 'rgba(99, 179, 237, 0.2)' : 'rgba(59, 130, 246, 0.2)',
                    fill: true,
                    tension: 0.4
                }]
            };

            const radarData = {
                labels: ['Desperdício', 'Adubos', 'Água', 'Solo'],
                datasets: [{
                    label: 'Métricas',
                    data: [15, 80, 70, 85],
                    backgroundColor: document.body.classList.contains('dark-mode') ? 'rgba(183, 148, 244, 0.2)' : 'rgba(139, 92, 246, 0.2)', /* Roxo adapta ao tema */
                    borderColor: document.body.classList.contains('dark-mode') ? '#b794f4' : '#805ad5',
                    borderWidth: 1,
                    pointBackgroundColor: document.body.classList.contains('dark-mode') ? '#b794f4' : '#805ad5',
                    pointBorderColor: document.body.classList.contains('dark-mode') ? '#2d3748' : '#fff',
                    pointHoverBackgroundColor: document.body.classList.contains('dark-mode') ? '#2d3748' : '#fff',
                    pointHoverBorderColor: document.body.classList.contains('dark-mode') ? '#b794f4' : '#805ad5'
                }]
            };

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#333' // Cor da legenda
                        }
                    },
                    title: {
                        display: false,
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#333' // Cor dos ticks do eixo X
                        },
                        grid: {
                            color: document.body.classList.contains('dark-mode') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)' // Cor da grade do eixo X
                        }
                    },
                    y: {
                        ticks: {
                            color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#333' // Cor dos ticks do eixo Y
                        },
                        grid: {
                            color: document.body.classList.contains('dark-mode') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)' // Cor da grade do eixo Y
                        },
                        beginAtZero: true,
                        max: 100 // Para gráficos de barra e radar que representam percentuais/pontuações
                    }
                }
            };

            switch (chartType) {
                case 'pie':
                case 'doughnut':
                    chartConfig = {
                        type: chartType,
                        data: data,
                        options: {
                            ...chartOptions,
                            scales: {} // Pie/Doughnut não usam escalas x/y
                        }
                    };
                    break;
                case 'bar-column':
                    chartConfig = {
                        type: 'bar',
                        data: barData,
                        options: {
                            ...chartOptions,
                            indexAxis: 'x',
                            plugins: {
                                ...chartOptions.plugins,
                                legend: { display: false }
                            },
                        }
                    };
                    break;
                case 'bar-horizontal':
                    chartConfig = {
                        type: 'bar',
                        data: barData,
                        options: {
                            ...chartOptions,
                            indexAxis: 'y',
                            plugins: {
                                ...chartOptions.plugins,
                                legend: { display: false }
                            },
                        }
                    };
                    break;
                case 'line':
                    chartConfig = {
                        type: 'line',
                        data: lineData,
                        options: {
                            ...chartOptions,
                            scales: {
                                ...chartOptions.scales,
                                y: {
                                    ...chartOptions.scales.y,
                                    max: 25 // Ajuste para o range do desperdício mensal
                                }
                            }
                        }
                    };
                    break;
                case 'radar':
                    chartConfig = {
                        type: 'radar',
                        data: radarData,
                        options: {
                            ...chartOptions,
                            scales: {
                                r: {
                                    angleLines: {
                                        display: false
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 100,
                                    ticks: {
                                        color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#333'
                                    },
                                    pointLabels: {
                                        color: document.body.classList.contains('dark-mode') ? '#e2e8f0' : '#333'
                                    },
                                    grid: {
                                        color: document.body.classList.contains('dark-mode') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                                    }
                                }
                            }
                        }
                    };
                    break;
                default:
                    chartConfig = {
                        type: 'pie',
                        data: data,
                        options: {
                            ...chartOptions,
                            scales: {}
                        }
                    };
                    break;
            }

            myChartInstance = new Chart(ctx, chartConfig);
        }

        // Event listeners para botões de tipo de gráfico
        document.querySelectorAll('#chartTypeButtons .chart-type-btn').forEach(button => {
            button.addEventListener('click', function() {
                const chartType = this.dataset.chartType;

                document.querySelectorAll('#chartTypeButtons .chart-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');

                initChart(chartType);
            });
        });

        // Atualizar seção de perfil
        function loadProfileData() {
            if (currentUser) {
                profileNameInput.value = currentUser.name || '';
                profileEmailInput.value = currentUser.email || '';
                profileCooperativeInput.value = currentUser.cooperative || '';
                profileFarmDataInput.value = currentUser.farmData || '';
                profilePicImg.src = currentUser.profilePic || "https://placehold.co/150x150/a7f3d0/065f46?text=Foto";
            }
        }

        // Função para salvar dados do perfil
        if (saveProfileBtn) {
            saveProfileBtn.addEventListener('click', async () => {
                showLoading(saveProfileBtn, saveProfileBtnText, saveProfileBtnSpinner);
                if (currentUser) {
                    currentUser.name = profileNameInput.value;
                    currentUser.cooperative = profileCooperativeInput.value;
                    currentUser.farmData = profileFarmDataInput.value;
                    currentUser.profilePic = profilePicImg.src; // Salva a URL da imagem
                    users[currentUser.email] = currentUser; // Atualiza no objeto users
                    localStorage.setItem('users', JSON.stringify(users)); // Salva no localStorage

                    // Simulação de delay para o salvamento
                    await new Promise(resolve => setTimeout(resolve, 700));

                    showMessage(profilePicMessage, 'Dados do perfil atualizados com sucesso!', 'success');
                }
                hideLoading(saveProfileBtn, saveProfileBtnText, saveProfileBtnSpinner);
            });
        }

        // Lógica para alterar a foto de perfil
        if (changeProfilePicBtn && profilePicInput && profilePicImg) {
            changeProfilePicBtn.addEventListener('click', () => {
                profilePicInput.click(); // Abre o seletor de arquivos
            });

            profilePicInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        profilePicImg.src = reader.result; // Atualiza a imagem exibida
                        if (currentUser) {
                            currentUser.profilePic = reader.result; // Salva a imagem no objeto do usuário
                            users[currentUser.email] = currentUser;
                            localStorage.setItem('users', JSON.stringify(users)); // Persiste no localStorage
                            showMessage(profilePicMessage, 'Foto de perfil atualizada!', 'success');
                        }
                    };
                    reader.onerror = () => {
                        showMessage(profilePicMessage, 'Erro ao carregar a imagem.', 'error');
                    };
                    reader.readAsDataURL(file); // Lê o arquivo como Data URL
                } else {
                    showMessage(profilePicMessage, 'Nenhuma imagem selecionada.', 'info');
                }
            });
        }

        // Função para alternar o modo escuro
        function toggleDarkMode() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            
            // Atualiza o localStorage
            if (isDarkMode) {
                localStorage.setItem('darkMode', 'enabled');
            } else {
                localStorage.removeItem('darkMode');
            }

            // Atualiza o estado do toggle no header
            if (headerDarkModeToggle) headerDarkModeToggle.innerHTML = `<i class="fas fa-${isDarkMode ? 'sun' : 'moon'}"></i>`;

            // Re-renderizar gráfico principal para atualizar cores
            if (myChartInstance) {
                initChart(myChartInstance.config.type);
            }
        }

        // Event listeners para o toggle de modo escuro do header
        if (headerDarkModeToggle) {
            headerDarkModeToggle.addEventListener('click', toggleDarkMode);
        }

        // Aplicar modo escuro ao carregar
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            if (headerDarkModeToggle) headerDarkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            if (headerDarkModeToggle) headerDarkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        }

        // --- Lógica do Popup de Permissão de Localização ---
        function checkLocationPermission() {
            const locationPermissionStatus = localStorage.getItem('locationPermission');
            const doNotAsk = localStorage.getItem('doNotAskAgain');

            if (locationPermissionStatus === 'granted') {
                getLocation();
                if (locationPermissionPopup) locationPermissionPopup.classList.remove('visible'); // Garante que o popup esteja escondido
            } else if (locationPermissionStatus === 'denied' && doNotAsk === 'true') {
                // Se negado e "não perguntar novamente" marcado, não mostra o popup
                if (locationPermissionPopup) locationPermissionPopup.classList.remove('visible');
                if (weatherInfo) showMessage(weatherInfo, 'Permissão de localização negada. O clima e o mapa podem não ser exibidos corretamente.', 'error');
                if (farmMap) farmMap.innerHTML = '<p class="text-gray-500">Mapa não disponível sem permissão de localização.</p>';
            } else {
                // Se não há status ou "não perguntar novamente" não está marcado, mostra o popup
                if (locationPermissionPopup) locationPermissionPopup.classList.add('visible');
            }
        }

        if (allowLocationBtn) {
            allowLocationBtn.addEventListener('click', () => {
                getLocation();
                if (locationPermissionPopup) locationPermissionPopup.classList.remove('visible'); // Esconde o popup imediatamente
                localStorage.setItem('locationPermission', 'granted'); // Salva o status da permissão
                if (doNotAskAgainCheckbox && doNotAskAgainCheckbox.checked) {
                    localStorage.setItem('doNotAskAgain', 'true');
                } else {
                    localStorage.removeItem('doNotAskAgain');
                }
            });
        }

        if (denyLocationBtn) {
            denyLocationBtn.addEventListener('click', () => {
                if (locationPermissionPopup) locationPermissionPopup.classList.remove('visible'); // Esconde o popup
                localStorage.setItem('locationPermission', 'denied'); // Salva o status da permissão
                if (doNotAskAgainCheckbox && doNotAskAgainCheckbox.checked) {
                    localStorage.setItem('doNotAskAgain', 'true');
                } else {
                    localStorage.removeItem('doNotAskAgain');
                }
                if (locationMessage) showMessage(locationMessage, 'Permissão de localização negada. O clima e o mapa podem não ser exibidos corretamente.', 'error');
                if (weatherInfo) weatherInfo.innerHTML = '<p class="text-lg">Localização negada. Não foi possível obter o clima.</p>';
                if (farmMap) farmMap.innerHTML = '<p class="text-gray-500">Mapa não disponível devido a erro de localização.</p>';
            });
        }

        async function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        
                        // Exibir clima usando OpenWeatherMap API
                        if (WEATHER_API_KEY && WEATHER_API_KEY !== "YOUR_OPENWEATHERMAP_API_KEY") {
                            try {
                                const response = await fetch(`${WEATHER_API_URL}?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric&lang=pt_br`);
                                const data = await response.json();
                                if (data && data.main && weatherInfo) {
                                    weatherInfo.innerHTML = `
                                        <p class="text-lg"><i class="fas fa-cloud-sun mr-2"></i>${data.main.temp}°C, ${data.weather[0].description}</p>
                                        <p class="text-sm">Umidade: ${data.main.humidity}%, Vento: ${data.wind.speed} m/s</p>
                                        <p class="text-xs">Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}</p>
                                    `;
                                } else {
                                    if (weatherInfo) weatherInfo.innerHTML = '<p class="text-lg">Não foi possível obter os dados climáticos.</p>';
                                }
                            } catch (error) {
                                console.error("Erro ao buscar dados climáticos:", error);
                                if (weatherInfo) weatherInfo.innerHTML = '<p class="text-lg">Erro ao obter o clima.</p>';
                            }
                        } else {
                            // Exibir clima simulado se a API Key não estiver configurada
                            if (weatherInfo) {
                                weatherInfo.innerHTML = `
                                    <p class="text-lg"><i class="fas fa-cloud-sun mr-2"></i>25°C, Ensolarado</p>
                                    <p class="text-sm">Umidade: 60%, Vento: 10 km/h</p>
                                    <p class="text-xs">Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}</p>
                                `;
                            }
                        }
                        if (locationMessage) showMessage(locationMessage, 'Localização obtida com sucesso!', 'success');

                        // Carregar mapa (simulado com OpenStreetMap)
                        if (farmMap) {
                            farmMap.innerHTML = `
                                <iframe 
                                    width="100%" 
                                    height="100%" 
                                    frameborder="0" 
                                    scrolling="no" 
                                    marginheight="0" 
                                    marginwidth="0" 
                                    src="https://www.openstreetmap.org/export/embed.html?bbox=${lon - 0.01},${lat - 0.005},${lon + 0.01},${lat + 0.005}&amp;layer=mapnik&amp;marker=${lat},${lon}" 
                                    style="border: 1px solid var(--input-border); border-radius: 0.5rem;">
                                </iframe>
                                <small class="mt-2 block"><a href="https://www.openstreetmap.org/#map=16/${lat}/${lon}" class="text-blue-500 hover:underline" target="_blank">Ver Mapa Maior</a></small>
                            `;
                        }
                    }, 
                    showError
                );
            } else {
                if (locationMessage) showMessage(locationMessage, 'Geolocalização não é suportada por este navegador.', 'error');
                if (weatherInfo) weatherInfo.innerHTML = '<p class="text-lg">Geolocalização não suportada.</p>';
                if (farmMap) farmMap.innerHTML = '<p class="text-gray-500">Mapa não disponível.</p>';
            }
        }

        function showError(error) {
            let errorMessage = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = 'Usuário negou a requisição de Geolocalização.';
                    localStorage.setItem('locationPermission', 'denied'); // Salva o status de negado
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = 'Informação de localização indisponível.';
                    break;
                case error.TIMEOUT:
                    errorMessage = 'A requisição para obter a localização expirou.';
                    break;
                case error.UNKNOWN_ERROR:
                    errorMessage = 'Um erro desconhecido ocorreu.';
                    break;
            }
            if (locationMessage) showMessage(locationMessage, `Erro de Geolocalização: ${errorMessage}`, 'error');
            if (weatherInfo) weatherInfo.innerHTML = `<p class="text-lg">Erro ao obter o clima: ${errorMessage}</p>`;
            if (farmMap) farmMap.innerHTML = '<p class="text-gray-500">Mapa não disponível devido a erro de localização.</p>';
            if (locationPermissionPopup) locationPermissionPopup.classList.remove('visible'); // Esconde o popup em caso de erro
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            checkLoginState();
            // Adiciona o estado inicial ao histórico para que o botão de voltar funcione corretamente
            if (location.hash) {
                const initialSection = location.hash.substring(1);
                showSection(initialSection, false); // Não empurra novamente se já está na URL
            } else {
                // Se não houver hash na URL, empurra o estado da landing page
                history.replaceState({ section: 'landing-page' }, '', '#landing-page');
                currentSectionId = 'landing-page';
            }
        });
    </script>
</body>
</html>
